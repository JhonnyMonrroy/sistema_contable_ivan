<!DOCTYPE html>
<html lang="es-ES">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ibm866">


<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Modulo Comprobantes v1.0</title>
<link href="../../css/bootstrap.min.css" rel="stylesheet">
<script src="../../js/jquery.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/angular.min.js"></script>
</head>
<body>
	<h1>Comprobante</h1>
	<div class="container" data-ng-app="comprobantesApp"
		data-ng-controller="comprobantesCtrl">
		<form class="form-horizontal">
			<div class="form-group">
				<label class="control-label col-sm-1" for="ncomprobante">No.:</label>
				<div class="col-sm-1">
					<input type="text" class="form-control" id="ncomprobante"
						placeholder="1">
				</div>
				<label class="control-label col-sm-1" for="ntc">No. Tipo:</label>
				<div class="col-sm-1">
					<input type="text" class="form-control" id="1" placeholder="1">
				</div>
				<label class="control-label col-sm-2" for="tipo_c">Comprobante
					de:</label>
				<div class="form-group col-sm-2">
					<select class="form-control" id="tipo_c">
						<option selected></option>
						<option ng-repeat="tipo in tipos_transaccion" value="{{tipo.id}}">{{tipo.tipo_transaccion}}</option>
					</select>
				</div>
				<label class="control-label col-sm-2" for="fecha_c">FECHA:</label>
				<div class="col-sm-2">
					<input type="text" class="form-control" id="fecha_c"
						placeholder="YYYY-MM-DD" ng-model="comprobante.fecha">
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-sm-1" for="glosa">Glosa:</label>
				<div class="col-sm-11">
					<input type="text" class="form-control" id="glosa"
						placeholder="Glosa del asiento">
				</div>
			</div>
			<div class="panel-heading">Detalle del comprobante</div>
			<div class="panel-body">
				<table class="table table-bordered">
					<thead>
						<tr>
							<th>COD_CUENTA</th>
							<th>DESCRIPCION</th>
							<th>DEBE</th>
							<th>HABER</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>
								<div class="form-group col-sm-10">
									<select class="form-control" id="sel1">
										<option selected></option>
										<option ng-repeat="cuenta in cuentas" value="{{cuenta.id}}">{{cuenta.CODIGO}}</option>
									</select>
								</div>
							</td>
							<td>Doe</td>
							<td>john@example.com</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="form-group">
				<label class="control-label col-sm-8" for="glosa">TOTAL:</label>
				<div class="col-sm-2">
					<input type="text" class="form-control" id="glosa"
						placeholder="Glosa del asiento">
				</div>
				<div class="col-sm-2">
					<input type="text" class="form-control" id="glosa"
						placeholder="Glosa del asiento">
				</div>
			</div>
		</form>
	</div>
<script>
var app = angular.module('comprobantesApp', []);
app.controller('comprobantesCtrl', function($scope, $http) {

	$scope.cargarDatos = function() {
		$http.get("api.php").then(function(response) {
			$scope.cuentas = response.data.cuentas;
			$scope.tipos_transaccion = response.data.tipos_transaccion;
		});
	};

	$scope.cargarDatos();
	
	

	$scope.comprobante={fecha: new Date()};

	/**
	 * Crear un nuevo objeto usuario
	 */
	$scope.nuevoUsuario = function() {
		$scope.tituloModal = "Nuevo usuario";
		$scope.usuario = {
			id : -1
		};
	};
	/**
	 * Se prepara el usuario para editar
	 */
	$scope.editarUsuario = function(idUsuario) {
		$scope.tituloModal = "Editar usuario";
		$http({
			url : 'api.php?id=' + idUsuario,
			method : "GET",
		}).then(function(response) {
			$scope.usuario = response.data;
			$('#editarUsuarioModal').modal('toggle');
		});
	};
	/**
	 * Guarda un objeto usuario
	 */
	$scope.guardarUsuario = function() {
		$http({
			url : 'api.php',
			method : $scope.usuario.id == -1 ? "POST" : "PUT",
			data : $scope.usuario
		}).then(function(response) {
			// alert(response.status);
			// console.log(response);
			if (response.status === 201 || response.status === 200) {
				$('#editarUsuarioModal').modal('toggle');
				$scope.cargarUsuarios();
			} else {
				alert("Ocurrio un error");
				console.log(response.data);
			}
		}, function(error) { // optional
			alert("Ocurrio un error");
			console.log("ERROR:", error)
		});
	};

	/**
	 * Eliminar Usuario
	 */
	$scope.eliminarUsuario = function(usuario) {
		//console.log(usuario);
		if (confirm("Esta seguro de eliminar al usuario: "+usuario.nombre)) {
			$http({
				url : 'api.php',
				method : "DELETE",
				data : {
					"id" : usuario.id
				}
			}).then(function(response) {
				$scope.cargarUsuarios();
			}, function(error) { // optional
				alert("Ocurrio un error");
				console.log("ERROR:", error)
			});
		}
	};
});

</script>
</body>
</html>